# Perf 综合分析工具介绍

## 1. 性能工具详细介绍

[Linux_Performance_Analysis_and_Tools.pdf](/kvm_blog/files/perf/Linux_Performance_Analysis_and_Tools.pdf)

[Linux_Performance_and_Tunning_guildlines.pdf](/kvm_blog/files/perf/Linux_Performance_and_Tunning_guildlines.pdf)

性能分析是一个综合东西非常复杂，从模块来分可以分为应用、系统库、系统调用、文件系统、网络、调度、内存，从层次来分有可以分为 用户层、系统层、虚拟化层。

解决一个性能瓶颈，往往又会出现论文的瓶颈或者其他问题，所以性能优化更加切实的目标是做到在一定范围内使系统的各项资源使用趋向合理和保持一定的平衡。系统运行良好的时候恰恰也是各项资源达到了一个平衡体，任何一项资源的过渡使用都会造成平衡体系破坏，从而造成系统负载极高或者响应迟缓。比如CPU 过度使用会造成大量进程等待 CPU 资源，系统响应变慢，等待会造成进程数增加，进程增加又会造成内存使用增加，内存耗尽又会造成虚拟内存使用，使用虚拟内存又会造成磁盘 IO 增加和CPU开销增加（用于进程切换、缺页处理的 CPU 开销）

##﻿﻿﻿﻿ 2. 综合分析工具
### 2.1 dstat
#### 2.1.1 dstat 介绍
dstat 是一个可以取代vmstat，iostat，netstat和ifstat这些命令的多功能产品。dstat克服了这些命令的局限并增加了一些另外的功能，增加了监控项，也变得更灵活了。dstat可以很方便监控系统运行状况并用于基准测试和排除故障。

dstat可以让你实时地看到所有系统资源，例如，你能够通过统计IDE控制器当前状态来比较磁盘利用率，或者直接通过网络带宽数值来比较磁盘的吞吐率（在相同的时间间隔内）。

dstat将以列表的形式为你提供选项信息并清晰地告诉你是在何种幅度和单位显示输出。这样更好地避免了信息混乱和误报。更重要的是，它可以让你更容易编写插件来收集你想要的数据信息，以从未有过的方式进行扩展。

Dstat的默认输出是专门为人们实时查看而设计的，不过你也可以将详细信息通过CSV输出到一个文件，并导入到Gnumeric或者Excel生成表格中。

#### 2.1.2 各列说明

	[root@hhb-kvm netperf-2.7.0]# dstat
	----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--
	usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw
	  0   0 100   0   0   0|  12k 4872B|   0     0 |   0     0 |  35    70
	  0   0 100   0   0   0|   0     0 | 595B  460B|   0     0 |  53   100
	  0   0 100   0   0   0|   0     0 | 198B  134B|   0     0 |  44    76
	  0   0 100   0   0   0|   0     0 | 394B  110B|   0     0 |  50    80
	  0   0 100   0   0   0|   0     0 | 648B  110B|   0     0 |  43    89
	  0   0 100   0   0   0|   0     0 | 712B  110B|   0     0 |  64   104
	  0   0 100   0   0   0|   0     0 | 320B  110B|   0     0 |  43    68
	  0   0 100   0   0   0|   0     0 | 953k   18k|   0     0 | 377   602
	  0   0 100   0   0   0|   0     0 |1234k   20k|   0     0 | 470   754
	  0   0 100   0   0   0|   0     0 |2095k   35k|   0     0 | 696  1230
	  0   0 100   0   0   0|   0     0 |2188k   37k|   0     0 | 702  1226
	  0   0  99   0   0   0|   0     0 |2793k   47k|   0     0 | 858  1529
	  0   0 100   0   0   0|   0     0 |3844k   65k|   0     0 |1128  2092
	  0   1  99   0   0   0|   0     0 |4553k   78k|   0     0 |1338  2471

- CPU状态：CPU的使用率。这项报告更有趣的部分是显示了用户，系统和空闲部分，这更好地分析了CPU当前的使用状况。如果你看到"wait"一栏中，CPU的状态是一个高使用率值，那说明系统存在一些其它问题。当CPU的状态处在"waits"时，那是因为它正在等待I/O设备（例如内存，磁盘或者网络）的响应而且还没有收到。

- 磁盘统计：磁盘的读写操作，这一栏显示磁盘的读、写总数。

- 网络统计：网络设备发送和接受的数据，这一栏显示的网络收、发数据总数。

- 分页统计：系统的分页活动。分页指的是一种内存管理技术用于查找系统场景，一个较大的分页表明系统正在使用大量的交换空间，或者说内存非常分散，大多数情况下你都希望看到page in（换入）和page out（换出）的值是0 0。

- 系统统计：这一项显示的是中断（int）和上下文切换（csw）。这项统计仅在有比较基线时才有意义。这一栏中较高的统计值通常表示大量的进程造成拥塞，需要对CPU进行关注。你的服务器一般情况下都会运行运行一些程序，所以这项总是显示一些数值。

#### 2.1.3 常用命令介绍

dstat可以通过传递2个参数运行来控制报告间隔和报告数量。例如，如果你想要dstat输出默认监控、报表输出的时间间隔为3秒钟,并且报表中输出10个结果，你可以运行如下命令：

	dstat 3 10

查看全部内存都有谁在占用：

	dstat -g -l -m -s --top-mem

显示一些关于CPU资源损耗的数据：

	dstat -c -y -l --proc-count --top-cpu

如何输出一个csv文件
想输出一个csv格式的文件用于以后，可以通过下面的命令：

	$ dstat –output /tmp/sampleoutput.csv -cdn

### 2.2 top

**cpu list**

技巧：运行 top 时，按「1」打开 CPU 列表，按「shift+p」以 CPU 排序。

**top 修改nice**

    $ top—>r —>PID—>nice值

**highlight**

    $ top-> b/y		
		$ top-> x/x

**change sort line**

		$ top -> shift + >/<   //left and right

**change display line**

		$ top -> f

**param explain**

		Process stutus: R=Run, S=Sleep, T=Tracing/Stop, D=No Interrupt Sleep, Z=zombie
		TIME+: Process use cpu time: 1/100 second.

### 2.3 htop

	$ yum install htop

# 3. 各种评测工具
	|---------------------------------------------------------|
	|          Applications, DBs, all server types, ...       |
	|              -------------------------------------------|
	|              |   System Libraries                       |
	|---------------------------------------------------------|
	|                System Call Interface                    |
	|---------------------------------------------------------|
	|          VFS            |   Sockets    |                |         +------+
	|-------------------------|--------------|    Scheduler   |---------|  CPU |
	|  ext4/... |             |   TCP/UDP    |                |         +------+
    |-----------|    ZFS      |--------------|----------------|            |
	|  LVM      |             |    IP        |                |            |
	|-------------------------|--------------| Virtual Memory |         +------+
	| Block Device Interface  |  Ethernet    |                |         | DRAM |
	|---------------------------------------------------------|         +------+
	|                     Device Drivers                      |
	|---------------------------------------------------------|
							  |
	                    +------------+
						| I/O Bridge |
                        +------------+
                              |
                 ----------------------------------------
				  |                                   |
	        +----------------+               +--------------------+
			| I/O Controller |               | Network Controller |
            +----------------+               +--------------------+
			   |          |                      |             |
            +------+   +------+              +------+      +------+
		    | Disk |   | Disk |              | Port |      | Port |
            +------+   +------+              +------+      +------+





## 3.1  System Call Interface
   strace

http://lzz5235.github.io/2013/11/22/ltrace-strace-ftrace.html

## 3.2

# 4. 综合评测工具

dstat -cdlmnpsy

https://linux.cn/article-3215-1.html
